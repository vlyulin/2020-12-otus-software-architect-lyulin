<?xml version="1.0" encoding="UTF-8"?>
<module type="JAVA_MODULE" version="4" />

# Курс "Software Architect" в OTUS

# Содержание:
* [Студент](#Студент)
* [Модуль hw01-Kubernetes](#Модуль-hw01-Kubernetes)
* [Модуль hw02-Kubernetes](#Модуль-hw02-Kubernetes)
* [Модуль hw03-Prometheus](#Модуль-hw03-Prometheus)
* [Модуль hw05-Apigateway](#Модуль-hw05-Apigateway)
* [Модуль hw07-StreamProcessing](#Модуль-hw07-StreamProcessing)

# Студент
ФИО слушателя: Люлин Вадим Евгеньевич
Название курса: 
Группа: 2020-12

## Модуль hw01-Kubernetes<a name="Модуль-hw01-Kubernetes"></a>
Основы работы с Kubernetes (часть 2)
Создать минимальный сервис, который
1) отвечает на порту 8000
2) имеет http-метод
GET /health/
RESPONSE: {"status": "OK"}

Cобрать локально образ приложения в докер.
Запушить образ в dockerhub

Написать манифесты для деплоя в k8s для этого сервиса.

Манифесты должны описывать сущности Deployment, Service, Ingress.
В Deployment могут быть указаны Liveness, Readiness пробы.
Количество реплик должно быть не меньше 2. Image контейнера должен быть указан с Dockerhub.

В Ingress-е должно быть правило, которое форвардит все запросы с /otusapp/{student name}/* на сервис с rewrite-ом пути. Где {student name} - это имя студента.

Хост в ингрессе должен быть arch.homework. В итоге после применения манифестов GET запрос на http://arch.homework/otusapp/{student name}/health должен отдавать {“status”: “OK”}.

На выходе предоставить
0) ссылку на github c манифестами. Манифесты должны лежать в одной директории, так чтобы можно было их все применить одной командой kubectl apply -f .
1) url, по которому можно будет получить ответ от сервиса (либо тест в postmanе). 

## Модуль hw02-Kubernetes<a name="Модуль-hw02-Kubernetes"></a>

Домашнее задание
Инфраструктурные паттерны
Сделать простейший RESTful CRUD по созданию, удалению, просмотру и обновлению пользователей.
Пример API - https://app.swaggerhub.com/apis/otus55/users/1.0.0

Добавить базу данных для приложения.
Конфигурация приложения должна хранится в Configmaps.
Доступы к БД должны храниться в Secrets.
Первоначальные миграции должны быть оформлены в качестве Job-ы, если это требуется.
Ingress-ы должны также вести на url arch.homework/ (как и в прошлом задании)

На выходе должны быть предоставлена
1) ссылка на директорию в github, где находится директория с манифестами кубернетеса
2) инструкция по запуску приложения.
- команда установки БД из helm, вместе с файлом values.yaml.
- команда применения первоначальных миграций
- команда kubectl apply -f, которая запускает в правильном порядке манифесты кубернетеса
3) Postman коллекция, в которой будут представлены примеры запросов к сервису на создание, получение, изменение и удаление пользователя. Важно: в postman коллекции использовать базовый url - arch.homework.


Задание со звездочкой:
+3 балла за шаблонизацию приложения в helm 3 чартах
+2 балла за использование официального helm чарта для БД

## Модуль hw03-Prometheus<a name="Модуль-hw03-Prometheus"></a>

Домашнее задание

Prometheus. Grafana

Инструментировать сервис из прошлого задания метриками в формате Prometheus с помощью библиотеки для вашего фреймворка и ЯП.

Сделать дашборд в Графане, в котором были бы метрики с разбивкой по API методам:

    Latency (response time) с квантилями по 0.5, 0.95, 0.99, max
    RPS
    Error Rate - количество 500ых ответов

Добавить в дашборд графики с метрикам в целом по сервису, взятые с nginx-ingress-controller:

    Latency (response time) с квантилями по 0.5, 0.95, 0.99, max
    RPS
    Error Rate - количество 500ых ответов

Настроить алертинг в графане на Error Rate и Latency.

На выходе должно быть: 0) скриншоты дашборды с графиками в момент стресс-тестирования сервиса. Например, после 5-10 минут нагрузки.

    json-дашборды.

Задание со звездочкой (+5 баллов) Используя существующие системные метрики из кубернетеса, добавить на дашборд графики с метриками:

    Потребление подами приложения памяти
    Потребление подами приолжения CPU

Инструментировать базу данных с помощью экспортера для prometheus для этой БД. Добавить в общий дашборд графики с метриками работы БД.

Альтернативное задание на 1 балл (если не хочется самому ставить prometheus в minikube) - https://www.katacoda.com/schetinnikov/scenarios/prometheus-client

## Модуль hw05-Apigateway<a name="Модуль-hw05-Apigateway"></a>

Домашнее задание

Backend for frontends. Apigateway

Добавить в приложение аутентификацию и регистрацию пользователей.

Реализовать сценарий "Изменение и просмотр данных в профиле клиента". Пользователь регистрируется. Заходит под собой и по определенному урлу получает данные о своем профиле. Может поменять данные в профиле. Данные профиля для чтения и редактирования не должны быть доступны другим клиентам (аутентифицированным или нет).

На выходе должны быть 0) описание архитектурного решения и схема взаимодействия сервисов (в виде картинки)

    команда установки приложения (из helm-а или из манифестов). Обязательно указать в каком namespace нужно устанавливать. 1*) команда установки api-gateway, если он отличен от nginx-ingress.
    тесты постмана, которые прогоняют сценарий:

    регистрация пользователя 1
    проверка, что изменение и получение профиля пользователя недоступно без логина
    вход пользователя 1
    изменение профиля пользователя 1
    проверка, что профиль поменялся
    выход* (если есть)
    регистрация пользователя 2
    вход пользователя 2
    проверка, что пользователь2 не имеет доступа на чтение и редактирование профиля пользователя1.

В тестах обязательно

    наличие {{baseUrl}} для урла
    использование домена arch.homework в качестве initial значения {{baseUrl}}
    использование сгенерированных случайно данных в сценарии
    отображение данных запроса и данных ответа при запуске из командной строки с помощью newman.

## Модуль hw07-StreamProcessing<a name="Модуль-hw07-StreamProcessing"></a>

Домашнее задание

Stream processing

Реализовать сервис заказа. Сервис биллинга. Сервис нотификаций.

При создании пользователя, необходимо создавать аккаунт в сервисе биллинга. В сервисе биллинга должна быть возможность положить деньги на аккаунт и снять деньги.

Сервис нотификаций позволяет отправить сообщение на email. И позволяет получить список сообщений по методу API.

Пользователь может создать заказ. У заказа есть параметр - цена заказа. Заказ происходит в 2 этапа:

    сначала снимаем деньги с пользователя с помощью сервиса биллинга
    отсылаем пользователю сообщение на почту с результатами оформления заказа. Если биллинг подтвердил платеж, должно отослаться письмо счастья. Если нет, то письмо горя.

Упрощаем и считаем, что ничего плохого с сервисами происходить не может (они не могут падать и т.д.). Сервис нотификаций на самом деле не отправляет, а просто сохраняет в БД.

ТЕОРЕТИЧЕСКАЯ ЧАСТЬ (5 баллов): 0) Спроектировать взаимодействие сервисов при создании заказов. Предоставить варианты взаимодействий в следующих стилях в виде sequence диаграммы с описанием API на IDL:

    только HTTP взаимодействие
    событийное взаимодействие с использование брокера сообщений для нотификаций (уведомлений)
    Event Collaboration cтиль взаимодействия с использованием брокера сообщений
    вариант, который вам кажется наиболее адекватным для решения данной задачи. Если он совпадает одним из вариантов выше - просто отметить это.

ПРАКТИЧЕСКАЯ ЧАСТЬ (5 баллов): Выбрать один из вариантов и реализовать его. На выходе должны быть 0) описание архитектурного решения и схема взаимодействия сервисов (в виде картинки)

    команда установки приложения (из helm-а или из манифестов). Обязательно указать в каком namespace нужно устанавливать.
    тесты постмана, которые прогоняют сценарий:

    Создать пользователя. Должен создаться аккаунт в биллинге.
    Положить деньги на счет пользователя через сервис биллинга.
    Сделать заказ, на который хватает денег.
    Посмотреть деньги на счету пользователя и убедиться, что их сняли.
    Посмотреть в сервисе нотификаций отправленные сообщения и убедиться, что сообщение отправилось
    Сделать заказ, на который не хватает денег.
    Посмотреть деньги на счету пользователя и убедиться, что их количество не поменялось.
    Посмотреть в сервисе нотификаций отправленные сообщения и убедиться, что сообщение отправилось.

В тестах обязательно

    наличие {{baseUrl}} для урла
    использование домена arch.homework в качестве initial значения {{baseUrl}}
    отображение данных запроса и данных ответа при запуске из командной строки с помощью newman.

